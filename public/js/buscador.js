"use strict";var auxSearch,titulo=document.getElementById("titulo"),boton=document.getElementById("buscar"),peliculaABuscar=document.getElementById("buscador"),resultado=document.querySelector(".peliculas"),black=document.querySelector(".fondo-opaco"),btnSalir=document.querySelector(".boton-salir"),contDetalles=document.querySelector(".cont-detalles"),verFavoritos=document.querySelector(".verFavoritos"),apiKey="715d100a",inShowFavorite=!1,user="",userKey="",borrarPeliculas=function(){var e=document.querySelectorAll(".pelicula"),t=e.length;if(t>0)for(var r=0;r<t;r++)resultado.removeChild(e[r]);return 0},MostrarFavoritos=function(){for(var e in borrarPeliculas(),inShowFavorite=!0,user.favoritos)agregarPelicula(e,user.favoritos)},verMas=function(e){console.log(e.path),black.style.opacity="1",black.style.zIndex="300";var t=e.path[1].id,r=inShowFavorite?user.favoritos[t]:auxSearch[t],o=r.Title,a=r.Year,i=r.imdbID,l=r.Poster,s=document.createElement("img");s.setAttribute("src",l),s.setAttribute("class","poster-verMas"),contDetalles.appendChild(s);var n=document.createElement("div");n.setAttribute("class","cont-datos"),contDetalles.appendChild(n);var c=document.createElement("h1");c.innerHTML=o,console.log(c),n.appendChild(c);var u=document.createElement("p");u.innerHTML="Year : ".concat(a),n.appendChild(u);var d=document.createElement("p");d.innerHTML="imdbID : ".concat(i),n.appendChild(d)},addFavorite=function(e){console.log(e.path);var t=e.path[1];console.log(e.path[3]);var r=e.path[3].id,o=inShowFavorite?user.favoritos[r]:auxSearch[r];console.log(o),"add to favorites"===t.title?(t.style.backgroundColor="yellow",t.setAttribute("title","remove from favorites"),user.favoritos[o.imdbID]=o):(t.style.backgroundColor="white",t.setAttribute("title","add to favorites"),inShowFavorite&&resultado.removeChild(e.path[3]),delete user.favoritos[o.imdbID]),localStorage.setItem(userKey,JSON.stringify(user)),sessionStorage.setItem(userKey,JSON.stringify(user))},esconderVerMas=function(){black.style.opacity="0",black.style.zIndex="0",contDetalles.removeChild(document.querySelector(".poster-verMas")),contDetalles.removeChild(document.querySelector(".cont-datos"))},buscarPeli=function(e){for(var t in user.favoritos)if(e.Title===user.favoritos[t].Title)return!0;return!1},agregarPelicula=function(e,t){var r=document.createElement("div");r.setAttribute("class","pelicula"),r.setAttribute("id",e);var o=document.createElement("img"),a=t[e].Poster;o.setAttribute("src",a),o.setAttribute("alt",e);var i=document.createElement("a");i.innerHTML="Ver detalles",i.setAttribute("class","btnDetalles"),i.onclick=verMas;var l=document.createElement("div");l.setAttribute("class","cont-Favorito");var s=document.createElement("div");s.setAttribute("class","btn-favorito"),s.setAttribute("title","add to favorites"),s.onclick=addFavorite;var n=document.createElement("img");n.setAttribute("src","./images/estrella.png"),s.appendChild(n),buscarPeli(t[e])?(s.style.backgroundColor="yellow",s.setAttribute("title","remove from favorites")):(s.style.backgroundColor="white",s.setAttribute("title","add to favorites")),l.appendChild(s),r.appendChild(i),r.appendChild(o),r.appendChild(l),resultado.appendChild(r)},apiRequest=function(){borrarPeliculas(),inShowFavorite=!1,fetch("https://www.omdbapi.com/?s=".concat(peliculaABuscar.value,"&apikey=").concat(apiKey)).then((function(e){return e.json()})).then((function(e){var t=e.Search;for(var r in auxSearch=t,t)agregarPelicula(r,t)}))},getUsuario=function(){for(var e in sessionStorage)if("user"===e.slice(0,-1))return userKey=e,JSON.parse(sessionStorage.getItem(e))};sessionStorage.length>0&&(user=getUsuario(),titulo.innerHTML+=user.nombre+"!"),boton.onclick=apiRequest,btnSalir.onclick=esconderVerMas,verFavoritos.onclick=MostrarFavoritos;