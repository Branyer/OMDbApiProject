"use strict";var titulo=document.getElementById("titulo"),btnBuscar=document.getElementById("buscar"),btnSalir=document.querySelector(".boton-salir"),btnShowFavoritos=document.querySelector(".verFavoritos"),peliculaABuscar=document.getElementById("buscador"),ctnResultado=document.querySelector(".peliculas"),ctnDetalles=document.querySelector(".cont-detalles"),fondoVerDetalles=document.querySelector(".fondo-opaco"),API_KEY="715d100a",inShowFavorite=!1,resultadoBusqueda="",objUser="",userKey="",getUsuario=function(){for(var e in sessionStorage)if("user"===e.slice(0,-1))return userKey=e,JSON.parse(sessionStorage.getItem(e))};objUser=getUsuario(),sessionStorage.getItem(userKey)?titulo.innerHTML+=objUser.nombre+"!":window.location.replace("index.html");var apiRequest=function(){borrarPeliculas(),inShowFavorite=!1,fetch("https://www.omdbapi.com/?s=".concat(peliculaABuscar.value,"&apikey=").concat(API_KEY)).then((function(e){return e.json()})).then((function(e){var t=e.Search;for(var r in resultadoBusqueda=t,t)agregarPelicula(r,t)}))},borrarPeliculas=function(){var e=document.querySelectorAll(".pelicula"),t=e.length;if(t>0)for(var r=0;r<t;r++)ctnResultado.removeChild(e[r]);return 0},MostrarFavoritos=function(){for(var e in borrarPeliculas(),inShowFavorite=!0,objUser.favoritos)agregarPelicula(e,objUser.favoritos)},getPath=function(e){for(var t="",r=0;!(t.id||(e=t=e.parentNode,++r>5)););return t},verMas=function(e){fondoVerDetalles.style.opacity="1",fondoVerDetalles.style.zIndex="300";var t=getPath(e.target).id,r=inShowFavorite?objUser.favoritos[t]:resultadoBusqueda[t],o=r.Title,a=r.Year,i=r.imdbID,s=r.Poster,n=document.createElement("img");n.setAttribute("src",s),n.setAttribute("class","poster-verMas"),ctnDetalles.appendChild(n);var l=document.createElement("div");l.setAttribute("class","cont-datos"),ctnDetalles.appendChild(l);var c=document.createElement("h1");c.innerHTML=o,console.log(c),l.appendChild(c);var d=document.createElement("p");d.innerHTML="Year : ".concat(a),l.appendChild(d);var u=document.createElement("p");u.innerHTML="imdbID : ".concat(i),l.appendChild(u)},addFavorite=function(e){console.log(e);var t=e.target.parentNode,r=getPath(e.target).id,o=inShowFavorite?objUser.favoritos[r]:resultadoBusqueda[r];"add to favorites"===t.title?(t.style.backgroundColor="yellow",t.setAttribute("title","remove from favorites"),objUser.favoritos[o.imdbID]=o):(t.style.backgroundColor="white",t.setAttribute("title","add to favorites"),inShowFavorite&&ctnResultado.removeChild(getPath(e.target)),delete objUser.favoritos[o.imdbID]),localStorage.setItem(userKey,JSON.stringify(objUser)),sessionStorage.setItem(userKey,JSON.stringify(objUser))},esconderVerMas=function(){fondoVerDetalles.style.opacity="0",fondoVerDetalles.style.zIndex="0",ctnDetalles.removeChild(document.querySelector(".poster-verMas")),ctnDetalles.removeChild(document.querySelector(".cont-datos"))},buscarPeli=function(e){for(var t in objUser.favoritos)if(e.Title===objUser.favoritos[t].Title)return!0;return!1},agregarPelicula=function(e,t){var r=document.createElement("div");r.setAttribute("class","pelicula"),r.setAttribute("id",e);var o=document.createElement("img"),a=t[e].Poster;o.setAttribute("src",a),o.setAttribute("alt",e);var i=document.createElement("a");i.innerHTML="Ver detalles",i.setAttribute("class","btnDetalles"),i.onclick=verMas;var s=document.createElement("div");s.setAttribute("class","cont-Favorito");var n=document.createElement("div");n.setAttribute("class","btn-favorito"),n.setAttribute("title","add to favorites"),n.onclick=addFavorite;var l=document.createElement("img");l.setAttribute("src","./images/estrella.png"),n.appendChild(l),buscarPeli(t[e])?(n.style.backgroundColor="yellow",n.setAttribute("title","remove from favorites")):(n.style.backgroundColor="white",n.setAttribute("title","add to favorites")),s.appendChild(n),r.appendChild(i),r.appendChild(o),r.appendChild(s),ctnResultado.appendChild(r)};btnBuscar.addEventListener("click",apiRequest),btnSalir.addEventListener("click",esconderVerMas),btnShowFavoritos.addEventListener("click",MostrarFavoritos);